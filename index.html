
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>安全访问代理</title>
    <style>
        body { margin:0; overflow:hidden; background:#f5f5f5 }
        #proxy-frame { 
            width:100vw; height:100vh; 
            border:none; position:fixed;
            top:0; left:0 
        }
        #loading {
            position:fixed; top:50%; left:50%;
            transform:translate(-50%,-50%);
            font-family:Arial; color:#666;
        }
    </style>
</head>
<body>
    <div id="loading">正在初始化安全通道...</div>
    <iframe id="proxy-frame" sandbox="allow-same-origin allow-forms allow-scripts allow-popups allow-top-navigation"></iframe>

    <script>
        // 内置代理模拟器（实际使用应替换为真实代理服务）
        function createVirtualProxy() {
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <script>
                        window.addEventListener('message', function(e) {
                            if(e.data.type === 'FETCH_REQUEST') {
                                fetch(e.data.url)
                                    .then(res => res.text())
                                    .then(html => {
                                        window.parent.postMessage({
                                            type: 'FETCH_RESPONSE',
                                            html: html,
                                            url: e.data.url
                                        }, '*');
                                    });
                            }
                        });
                    </script>
                </head>
                <body></body>
                </html>
            `;
        }

        // 主代理控制器
        class ProxyController {
            constructor() {
                this.iframe = document.getElementById('proxy-frame');
                this.loading = document.getElementById('loading');
                this.currentUrl = 'https://xz.xffwz.com/s/TURBd01EQXdNREF3TUg3TGVIQQ'; // 默认起始页
                this.init();
            }

            init() {
                // 使用Blob URL加载虚拟代理
                const proxyHtml = createVirtualProxy();
                const blob = new Blob([proxyHtml], {type: 'text/html'});
                this.iframe.src = URL.createObjectURL(blob);
                
                this.iframe.onload = () => {
                    this.loadUrl(this.currentUrl);
                    this.loading.style.display = 'none';
                    
                    // 监听内部跳转请求
                    window.addEventListener('message', (e) => {
                        if (e.data.type === 'NAVIGATE_REQUEST') {
                            this.loadUrl(e.data.url);
                        } else if (e.data.type === 'FETCH_RESPONSE') {
                            this.renderPage(e.data.html, e.data.url);
                        }
                    });
                };
            }

            loadUrl(url) {
                this.currentUrl = url;
                this.iframe.contentWindow.postMessage({
                    type: 'FETCH_REQUEST',
                    url: url
                }, '*');
            }

            renderPage(html, url) {
                // 注入跳转控制脚本
                const injectedScript = `
                    <script>
                        document.addEventListener('click', function(e) {
                            if(e.target.tagName === 'A') {
                                e.preventDefault();
                                parent.postMessage({
                                    type: 'NAVIGATE_REQUEST',
                                    url: e.target.href
                                }, '*');
                            }
                        }, true);
                    </script>
                `;
                html = html.replace('</body>', injectedScript + '</body>');
                
                // 更新iframe内容
                this.iframe.srcdoc = html;
                history.replaceState(null, '', `?url=${encodeURIComponent(url)}`);
            }
        }

        // 启动代理系统
        new ProxyController();
    </script>
</body>
</html>
